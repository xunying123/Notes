# 计网 阅读笔记



[TOC]

## 第一章，堂堂开坑！

- 概述：通信网络是以协议为基础的，且通信通过套接字进行。在按照协议建立连接以后，将数据分包，根据协议加上头尾，从套接字进行传输。
- 接入互联网
  - 拨号上网，和电话线用的同一根线缆，但二者可以并行，因为频率不同；
  - 电缆与光缆，经过调制解调器接入家庭网络；
  - 以太网，一种局域网（LAN）接入技术
- 存储转发传输：把一个包的全部内容都收到以后再进行转发；延迟大，上限低；
- 分组交换：不预留，直接传，网络尽最大努力确保不出错，但不保证；
- 电路交换，在数据传输前建立连接，让途径的交换机和路由预留数据传输的余量；
- FDM频分复用，不同链接分频率；
- TDM时分复用，将时间按帧划分，每个帧分为时隙，不同的连接分配固定的时隙；
- 网络特点：时延，吞吐，丢包；
- tracerote
- 七层OSI网络模型：
  - 应用层：网络应用程序以及其应用协议。DNS？
  - 表示层：数据压缩，加密，数据描述；
  - 会话层：数据交换的同步，建立检查点，恢复；
  - 运输层：TCP/UDP；
  - 网络层：IP;
  - 链路层：以太网，WIFI，DOCSIS；
  - 物理层：实际传输媒体；

## 第二章，应用层

- 客户-服务器结构；P2P；
- 发起通信的的进程成为客户，等待联系的称为服务器；
- 进程通过套接字进行通信；
- TCP：可靠数据传输，需要先握手，建立的连接是全双工的，断开需拆除；
- UDP：无连接，不保证数据传输；
- 应用层协议，定义了不同应用程序之间，如何传输，如HTTP,SMTP；

### Web 和HTTP

- HTTP，超文本传输协议，使用TCP，无状态协议；

- C发起请求，S 接受，建立连接；C 请求文件，S 发送，结束；

- 非持续性连接，持续连接；

```http
GET /somedir/page.html HTTP/1.1
Host: www.someschool.edu
Connection: close
User-agent: Mozilla/5.0
Accept-language: fr
  
```

- 以上为一个请求报文，第一行为请求行，之后为首部行，最后一行需要换行；
- 请求行：

  - 方法字段：GET、POST、HEAD、PUT、DELETE
  - URL字段：目标；
  - HTTP版本字段：字面含义；
- 首部行：

  - Host：用来高速缓存；
  - Connection：非持续性连接；
  - User-agent：浏览器类型；
  - Accept-language：语言版本？

```http
HTTP/1.1 200 OK
Connection: close
Date: Tue, 18 Aug 2015 15:44:04 GMT
Server: Apache/2.2.3 (CentOS)
Last-Modified: Tue, 18 Aug 2015 15:11:03 GMT
Content-Length: 6821
Content-type: text/html
(data.........)
```

- 以上为相应报文，分为初始状态行，首部行，实体体；
- 状态行：
  - 版本；
  - 状态码：200 301 400 404 505
- 首部行：
  - Date：发送该相应报文的时间，也可以看做发送的数据获取的时间？
  - Last-Modified：目标数据最后修改/创建时间，用于区分本地还是缓存；
- cookie ：S 用来区分C ；
  - C 第一次访问时，由S 指定一个标识，在相应的首部行中加入 `set-cookie`；
  - 以后的C 的请求中，首部行都会添加 `cookie`；
  - 会定时删除，但会导致隐私问题；
- 网络缓存，好也不好（经典缓存论断）；
- 条件GET，通过增加首部行 `If-modified-since:` ，内容为Last-Modified的时间，判断是否一致；（由缓存方发起）

### Mail

- C 发送到邮件发送方服务器，再发送到邮件接收方服务器，最后发送到接收方，都是SMTP 协议；
- SMTP 是一种推协议，不能主动去索取，HTTP是一种拉协议，从别处获取资源；
- POP3，IMAP；

### DNS

- 采用UDP 协议通信，将域名翻译为IP 地址；
- 会导致网络通信额外的时延，因此需要缓存以及就近存取；
- DNS 采用分布式分布，根服务器，顶级域服务器，权威DNS 服务器；
- 层次之外，本地DNS 服务器，起到一个代理转发以及缓存的作用；
- DNS 记录：(Name, Value, Type, TTL)，TTL为该记录的生存时间，决定了什么时候被删除：
  - Type = A，主机名 - IP地址；
  - Type = NS，域（如 foo.com）- 如何获得该域中主机IP 地址的权威DNS 服务器的主机名；
  - Type = CNAME，别名 - 别名为NAME 的主机的规范主机名；
  - Type = MX，别名 - 别名为NAME 的邮件服务器的规范主机名；

### P2P

- 磁链？算是其中一种，分布式的，没有中心；迅雷应该不算中心，它只提供了一个下载加速的功能，资源本身还是从其他设备得到；
- 具有自扩展性，代价是不稳定的连接与不稳定的速度；
- DHT，分布式散列表 ，一种简单的数据库实现；
- 个人碎碎念（2024.7.11）：这大概七年的网络冲浪下来，P2P下载 ，尤其是以磁链为首的下载方式，可以说逐渐落后于时代。这不仅仅是技术上的更新迭代，还有国内网络环境的问题。磁链的下载极其依靠做种的人，只有做种的人多这个种子才能健康。但在国内的大环境，尤其是迅雷出现并广泛传播以后，国内做种的人数越来越少，只能说吸血雷不愧是吸血雷。

## 第三章，运输层

- 运输层协议将来自应用层的报文移动至网络边缘，但并不参与 其在网络中的传输；
- 网络传输本身是一种不可靠传输，但TCP通过协议规定将传输变为可靠传输；
- 多路复用与多路分解；

### UDP

- 无连接，在数据传输时不提前建立链接，而是直接发送；

- DNS 使用UDP；

- UDP 是实时的，打包即发送，但TCP 并不是实时的，可能会拥堵与等待；

- TCP需要三次握手，相比UDP而言有一定的时延；

- 报文段：2字节源端口号与2字节目的端口号，2字节长度与2字节校验和；

- 校验和：

  - 发送方：将报文段所有16比特字的和进行反码操作，求和时的溢出加到最后一位（反卷）；

    取反作为校验和；

  - 接收方：报文段四个16比特字加在一起，如果没错，结果应当为111111111111111；

### TCP

- 自动重传请求协议（ARQ）
- 用来确保可靠传输的措施：校验和，定时器，序号，确认，否定确认，流水线，窗口；
- rdt3.0，回退N步与选择重传；
- TCP连接一定是一对一的；
- MSS，最大报文段长度，仅指的是应用层的数据，不包括TCP报头；
- 报文段：20字节
  - 1字节源端口号，1字节目的端口号；
  - 2字节序号，2字节确认号，用来实现可靠数据传输；
  - 4比特首部长度字段（单位是2字节），6比特空，6比特标志字段（CWR, ECE, URG, ACK, PSH, RST, SYN, FIN），共1字节；
  - 1字节接收窗口字段；
  - 1字节因特网校验和，1字节紧急数据指针；
  - 可选项；
- 序号：将文件数据按照MSS 划分，依序编号；
- 确认号：由于TCP是全双工的，所以确认号是发送方下一个希望接收到的分段；
- 为了确保端对端的正确接受，TCP采取了很多措施与规定，太长了不想打上去；
- TCP连接管理：
  - 三握手：
    - C 向S 发送一条特殊的TCP报文段，不包含应用层数据，但SYN=1，也因此被称为SYN报文段，且随机选择初始序号；
    - S 收到，设立缓存向C 发送允许连接，也不包含应用层数据，SYN=1，确认号为上面的序号+1，也选择一个随机的初始序号，发送。称为SYNACK报文段；
    - C 收到，也分配变量与缓存，并对上一条消息进行确认，这一条可以携带应用层数据；
  - 中断：
    - FIN=1，另一方确认；
    - 另一方FIN=1，一方确认；
- 拥塞控制：IP系统不会向端系统提供有关网络拥堵的反馈信息；
- TCP通过cwnd（拥塞窗口）来限制流量；
- 如果丢包（超时或收到三个冗余ACK），就认为网络出现了阻塞;
- TCP拥塞控制算法：慢启动，拥塞避免，快速恢复（非必须）；
- 慢启动的速率是指数增长的；

==TCP未完待续==

## 网络层：数据层面

- 网络层基本功能：转发，路由选择；
- 转发：将分组从本地的一个输入链扣转移到适当的输出链口；
- 路由选择：从源到目的地的选择；
- 网络层仅提供尽力而为的服务，不保证正确，到达，顺序，延迟；
- 控制层面：路由选择处理器，路由选择算法；数据层面：路由表；
- 排队算法：FIFO，优先权派对，循环排队，加权公平派对（WFQ）；
- IPV4数据报：
  - 4比特版本，4比特首部长度，8比特服务类型，16比特数据报长度；
  - 16比特标识， 3比特标志，13比特偏移；（分片）
  - 8比特寿命（TTL），8比特协议（决定哪个运输层协议处理它），16比特首部校验和；
  - 32比特源地址，32比特目标地址；
  - 可选项，但此功能导致处理变慢，因此v6已舍弃；
  - 数据；
- MTU：最大传送单元，一个链路层帧能承载的最大数据量；
- 子网掩码。。。
- 子网寻址：`a.b.c.d/x`

- DHCP：动态主机配置协议，即插即用；
  - DHCP服务器发现：新用户接入后，通过广播一个DHCP 发现报文；
  - DHCP服务器提供：收到发现报文后，服务器广播一个DHCP 提供报文；
  - DHCP请求：新用户选择一个服务，向他发送DHCP 请求报文；
  - DHCP ACK：服务器收到后，回复一个DHCP ACK报文；
- 网络地址转换NAT：把内网里面的地址转换为公网地址；
- 代价是一些端到端IP连接的应用，如P2P，需要额外的端口映射才能正常使用；
- IPV6：尽管可以使用内网等技术复用IP地址，IPV4还是会在可观的时间内被消耗完，因此需要一个地址空间更大的协议来应对日益增长的需求；
- IPV6数据报：
  - 4比特版本，8比特流量类型，20比特流标签；
  - 16比特有效载荷长度，8比特下一个首部，8比特寿命（跳限制）；
  - 128比特源地址与128比特目的地址；
  - 数据；
- 没有分片，因为IPV6不允许路由西进行分片，如果传不了就丢弃并返回错误；
- 没有校验和，因为TTL的存在，每个路由器都需要重新计算一遍校验和，导致转发缓慢；
- V4和V6的转换，跨版本无论何时都是一大坨---；

## 网络层：控制层面

